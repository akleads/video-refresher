# Requirements Archive: v3.0 Hybrid Processing

**Archived:** 2026-02-10
**Status:** SHIPPED

For current requirements, see `.planning/REQUIREMENTS.md`.

---

# Requirements: Video Refresher v3.0

**Defined:** 2026-02-08
**Core Value:** Upload video creatives, get multiple unique variations ready for ad platform rotation -- fast, without waiting at the screen.

## v3.0 Requirements

Requirements for hybrid processing and job cancellation. Each maps to roadmap phases.

### Infrastructure

- [x] **INFRA-06**: COOP/COEP headers restored on Cloudflare Pages for SharedArrayBuffer support
- [x] **INFRA-07**: Backend sends Cross-Origin-Resource-Policy: cross-origin header for COEP compatibility

### Device Processing

- [x] **DEVC-01**: FFmpeg.wasm 0.12.x runs in Web Worker with multi-threaded support
- [x] **DEVC-02**: Client-side ZIP generation with JSZip streaming mode for large batches
- [x] **DEVC-03**: Per-variation progress tracking during device processing
- [x] **DEVC-04**: Device processing bypasses server API entirely (no job tracking, local-only)
- [x] **DEVC-05**: Browser capability detection -- fallback to server mode if SharedArrayBuffer unavailable

### Processing Mode

- [x] **MODE-01**: Radio button toggle on upload page: "Process on device" vs "Send to server"
- [x] **MODE-02**: Mode preference persisted in localStorage across sessions
- [x] **MODE-03**: Shared effect generation library used by both device and server modes (identical variations)

### Job Cancellation

- [x] **CANC-01**: Cancel button on job detail page for in-progress server jobs
- [x] **CANC-02**: Server cancellation endpoint kills FFmpeg process and cleans up partial files
- [x] **CANC-03**: Graceful FFmpeg termination sequence (stdin 'q' → SIGTERM → SIGKILL)
- [x] **CANC-04**: Cancelled jobs show "Cancelled" status in job history

## Future Requirements

Deferred to post-v3.0 milestones.

- **SSE-01**: Server-Sent Events for real-time server job progress
- **META-01**: Metadata JSON manifest in ZIP documenting effects applied per variation
- **RETRY-01**: Retry individual failed videos without re-uploading entire batch
- **RESUME-01**: Resumable uploads for large files over unreliable connections

## Out of Scope

| Feature | Reason |
|---------|--------|
| Automatic mode switching mid-job | Confusing UX, two modes should be independent |
| Pause/resume for device processing | High complexity, low value for short ad creatives |
| Undo cancellation | Once FFmpeg killed, partial files are cleaned up |
| Hybrid/split processing (some files device, some server) | Over-engineered for the use case |
| Toggle switch UX (instead of radio buttons) | Toggle implies immediate effect; radio buttons suit workflow choice applied on submit |

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| INFRA-06 | Phase 10 | Complete |
| INFRA-07 | Phase 10 | Complete |
| DEVC-01 | Phase 11 | Complete |
| DEVC-02 | Phase 11 | Complete |
| DEVC-03 | Phase 11 | Complete |
| DEVC-04 | Phase 11 | Complete |
| DEVC-05 | Phase 10 | Complete |
| MODE-01 | Phase 13 | Complete |
| MODE-02 | Phase 13 | Complete |
| MODE-03 | Phase 10 | Complete |
| CANC-01 | Phase 12 | Complete |
| CANC-02 | Phase 12 | Complete |
| CANC-03 | Phase 12 | Complete |
| CANC-04 | Phase 12 | Complete |

**Coverage:**
- v3.0 requirements: 14 total
- Mapped to phases: 14
- Unmapped: 0

---
*Requirements defined: 2026-02-08*
*Traceability updated: 2026-02-09 — ALL v3.0 REQUIREMENTS COMPLETE*
